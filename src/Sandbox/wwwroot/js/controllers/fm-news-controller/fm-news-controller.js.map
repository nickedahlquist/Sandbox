{"version":3,"names":[],"mappings":"","sources":["controllers/fm-news-controller/fm-news-controller.js"],"sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  // Setup routing.\r\n  angular.module('fm').config(['$stateProvider', function ($stateProvider) {\r\n\r\n    $stateProvider\r\n\r\n      .state('news', {\r\n        url: '/news',\r\n        controller: 'FmNewsCtrl',\r\n        controllerAs: 'fmNews',\r\n        resolve: {\r\n          $title: function () {\r\n            return 'Nyheter';\r\n          },\r\n          newsData: function (fmNewsService) {\r\n            return fmNewsService.getNews();\r\n          }\r\n        },\r\n        templateUrl: 'views/fm-news-view.html',\r\n      });\r\n\r\n  }]);\r\n\r\n  // Register controller.\r\n  angular.module('fm').controller('FmNewsCtrl', ['newsData', '$sanitize', 'fmUtilityFunctions', '$timeout', FmNewsCtrl]);\r\n\r\n  // Define controller-function.\r\n  function FmNewsCtrl(newsData, $sanitize, fmUtilityFunctions, $timeout) {\r\n\r\n    /* jshint validthis: true */\r\n    var vm = this;\r\n    var utils = fmUtilityFunctions;\r\n\r\n    vm.newsItems = newsData;\r\n    vm.latestNews = _.sortBy(newsData.slice(0, 3), 'PublishDate');\r\n\r\n    console.log(vm.newsItems);\r\n\r\n    for (var key in vm.newsItems) {\r\n      vm.newsItems[key].TextExcerpt = $sanitize(fmUtilityFunctions.truncateText(150, vm.newsItems[key].NewsText.split('<br/>')[0]));\r\n      vm.newsItems[key].SignatureExcerpt = $sanitize(vm.newsItems[key].Signature.split('<br/>')[0]);\r\n      vm.newsItems[key].NewsText = $sanitize(vm.newsItems[key].NewsText);\r\n    }\r\n\r\n    \r\n    // Simulate lazy loading\r\n    var tempArr = _.groupBy(vm.newsItems, function (element, index) {\r\n      return Math.floor(index/6);\r\n    });\r\n\r\n    tempArr = _.toArray(tempArr);\r\n\r\n    vm.newsItems = tempArr[0];\r\n    var arrIndex = 1;\r\n    vm.fetching = false;\r\n\r\n    vm.readMore = function () {\r\n      vm.fetching = true;\r\n\r\n      $timeout(function () {\r\n        if (arrIndex < tempArr.length) {\r\n          vm.newsItems = vm.newsItems.concat(tempArr[arrIndex]);\r\n          arrIndex++;\r\n        }\r\n        vm.fetching = false;\r\n      }, 1500);\r\n    };\r\n  }\r\n\r\n})();\r\n"],"file":"controllers/fm-news-controller/fm-news-controller.js","sourceRoot":"/source/"}