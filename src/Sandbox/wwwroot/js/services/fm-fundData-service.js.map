{"version":3,"names":[],"mappings":"","sources":["services/fm-fundData-service.js"],"sourcesContent":["(function () {\r\n  'use strict';\r\n\r\n  angular.module('fm').service('fmFundDataService', ['$http', '$q', 'fmConfig', 'fmUtilityFunctions', fmFundDataService]);\r\n\r\n  function fmFundDataService($http, $q, fmConfig, fmUtilityFunctions) {\r\n\r\n    var utils = fmUtilityFunctions;\r\n\r\n    function loadFundData(urlIn) {\r\n      var url = urlIn,\r\n          deferred = $q.defer();\r\n\r\n      $http.get(url).then(onSuccess, onError);\r\n\r\n      function onSuccess(res) {\r\n        var fundItems = res.data;\r\n        deferred.resolve(fundItems);\r\n      }\r\n\r\n      function onError(res) {\r\n        deferred.reject(res);\r\n      }\r\n\r\n      return deferred.promise;\r\n    }\r\n\r\n    \r\n\r\n    return {\r\n      getFunds: function () {\r\n        var url = fmConfig.webAPI.url + 'api/Fund?$count=true&$expand=FundInfo';\r\n        return loadFundData(url);\r\n      },\r\n      getFundById: function (id) {\r\n        var url = fmConfig.webAPI.url + 'api/Fund?$filter=Id%20eq%20' + id + '&$expand=FundInfo,CompanyHoldings';\r\n        return loadFundData(url);\r\n      },\r\n      getFundByIsin: function (isin) {\r\n        var url = fmConfig.webAPI.url + 'api/Fund?$filter=Isin%20eq%20%27' + isin + '%27&$expand=FundInfo,NavHistory($orderby=RateDate%20desc)';\r\n        return loadFundData(url);\r\n      },\r\n      getNavHistory: function (isin, fromDateIn, toDateIn, sampleRateIn) {\r\n\r\n        //Set default values\r\n        var now = Date.now();\r\n        var prevYear = new Date(Date.now());\r\n        prevYear = prevYear.setFullYear(prevYear.getFullYear() - 1);\r\n\r\n        var fromDate = (typeof fromDateIn !== 'undefined') ? fromDateIn : utils.formatDate(prevYear);\r\n        var toDate = (typeof toDateIn !== 'undefined') ? toDateIn : utils.formatDate(now);\r\n        var sampleRate = (typeof sampleRateIn !== 'undefined') ? sampleRateIn : '7';\r\n\r\n        //Build query\r\n        var url = fmConfig.webAPI.url + 'api/Nav/GetNavHistory/' + isin + '/' + sampleRate + '/' + fromDate + '/' + toDate;\r\n        return loadFundData(url);\r\n      },\r\n      getNextLinks: function (nextLinks) {\r\n        var url = nextLinks;\r\n        return loadFundData(url);\r\n      },\r\n      getResultsPage: function (pageNumber) {\r\n        var url = fmConfig.webAPI.url + 'api/Fund?$expand=FundInfo&$skip=' + (pageNumber * 10);\r\n        return loadFundData(url);\r\n      }\r\n    };\r\n  }\r\n\r\n})();"],"file":"services/fm-fundData-service.js","sourceRoot":"/source/"}